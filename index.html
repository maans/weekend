<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiselist Weekend - Fuld Version</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white !important; color: black !important; padding: 0; margin: 0; }
            .page-break { page-break-after: always; height: 0; border: 0; }
            h1, h2, h3, h4, p, span, td, th, li { color: black !important; }
            @page { margin: 1cm; size: A4; }
        }
        .print-only { display: none; }
        body { background-color: #0A0E1A; overflow-x: hidden; color: white; font-family: sans-serif; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }
        .wise-card { transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .wise-card:active { transform: scale(0.98); }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@19.0.0",
        "react-dom": "https://esm.sh/react-dom@19.0.0",
        "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.460.0",
        "xlsx": "https://esm.sh/xlsx@0.18.5"
      }
    }
    </script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-presets="react,typescript" data-type="module">
import React, { useState, useMemo, useCallback, useEffect, useRef } from 'react';
import ReactDOM from 'react-dom/client';
import { 
  Users, Utensils, Trash2, FileText, Upload, ChevronRight, ArrowRightLeft, 
  Trash, CheckCircle2, XCircle, Printer, ChevronUp, ChevronDown, Database, 
  Search, X, Clock, Bed, MapPin, Plus, Lock, Unlock, AlertCircle, Check, 
  Home, HelpCircle, BookOpen, PieChart, Download, Compass, Flame, Info
} from 'lucide-react';
import * as XLSX from 'xlsx';

// --- KONFIGURATION ---
const STORAGE_KEY = 'weekend_full_v2_storage';
const WISE_COLORS = ['bg-[#FFB300]', 'bg-[#00BFA5]', 'bg-[#D81B60]', 'bg-[#1E88E5]', 'bg-[#5E35B1]'];

const CLEANING_CONFIG = [
  { name: "Arken", count: 2 },
  { name: "Den lange gang", count: 3 },
  { name: "Gangene i treenigheden", count: 2 },
  { name: "Biografen", count: 1 },
  { name: "Kunst", count: 1 },
  { name: "Klassefløjen + toiletter", count: 4 },
  { name: "Toiletter i hallen", count: 3 },
  { name: "Toiletter på den lange gang", count: 2 },
  { name: "Gymnastiksalen", count: 2 },
  { name: "Hallen", count: 2 }
];

const TASK_CONFIG = [
  { id: 'f1', label: 'Fredag: Før Aftensmad', day: 'Fredag' },
  { id: 'f2', label: 'Fredag: Efter Aftensmad', day: 'Fredag' },
  { id: 'f3', label: 'Fredag: Aftenservering', day: 'Fredag' },
  { id: 'l1', label: 'Lørdag: Før Mokost', day: 'Lørdag' },
  { id: 'l2', label: 'Lørdag: Efter Mokost', day: 'Lørdag' },
  { id: 'l3', label: 'Lørdag: Før Aftensmad', day: 'Lørdag' },
  { id: 'l4', label: 'Lørdag: Efter Aftensmad', day: 'Lørdag' },
  { id: 'l5', label: 'Lørdag: Aftenservering', day: 'Lørdag' },
  { id: 's1', label: 'Søndag: Før Mokost', day: 'Søndag' },
  { id: 's2', label: 'Søndag: Efter Mokost', day: 'Søndag' }
];

const COMMON_SLEEPING_AREAS = ["Teltet", "Shelteret", "Gymnastiksalen", "Medie", "Biografen", "Sofaen"];

// --- LOGIK & HJÆLPERE ---
const getActualDayName = () => {
  const d = new Date().getDay();
  if (d === 6) return 'Lørdag';
  if (d === 0) return 'Søndag';
  return 'Fredag';
};

const cleanValue = (val) => {
  if (val === null || val === undefined) return '';
  return String(val).split(',')[0].split('(')[0].trim();
};

const processExcelData = (data) => {
  if (data.length < 2) return [];
  const headers = data[0].map(h => String(h).trim().toLowerCase());
  const findIdx = (names) => headers.findIndex(h => names.some(n => h.includes(n)));

  const idx = {
    first: findIdx(['fornavn', 'first name']),
    last: findIdx(['efternavn', 'last name']),
    room: findIdx(['værelse', 'room']),
    house: findIdx(['house', 'gang', 'hus']),
    weekend: findIdx(['weekend', 'til stede', 'status'])
  };

  return data.slice(1).filter(row => row.length > 0 && row[idx.first]).map((row, i) => {
    const presenceStr = String(row[idx.weekend] || '').toLowerCase();
    let stayType = 'none';
    if (presenceStr.includes('hele') || presenceStr === 'ja' || presenceStr === '1' || presenceStr === 'true') stayType = 'full';
    else if (presenceStr.includes('indtil lørdag')) stayType = 'saturday';

    const house = cleanValue(row[idx.house]) || 'Ukendt Gang';
    const room = cleanValue(row[idx.room]) || '??';

    return {
      id: `std-${Date.now()}-${i}`,
      firstName: String(row[idx.first] || ''),
      lastName: String(row[idx.last] || ''),
      room, house,
      isPresent: stayType !== 'none',
      stayType,
      isKitchenDuty: false,
      isMarked: false,
      hasReturned: false,
      sleepingLocations: { 'Fredag': `${house} - ${room}`, 'Lørdag': `${house} - ${room}`, 'Søndag': `${house} - ${room}` }
    };
  });
};

// --- KOMPONENTER ---
const SwipableStudentCard = ({ student, color, onSwipe, onKitchenClick }) => {
  const startX = useRef(0);
  const [offset, setOffset] = useState(0);

  const handleStart = (e) => startX.current = 'touches' in e ? e.touches[0].clientX : e.clientX;
  const handleMove = (e) => {
    if (startX.current === 0) return;
    const currentX = 'touches' in e ? e.touches[0].clientX : e.clientX;
    const diff = currentX - startX.current;
    if (Math.abs(diff) > 10) setOffset(diff);
  };
  const handleEnd = () => {
    if (Math.abs(offset) > 100) onSwipe();
    setOffset(0);
    startX.current = 0;
  };

  return (
    <div className="relative overflow-hidden rounded-[2.5rem] mb-3 wise-card" onTouchStart={handleStart} onTouchMove={handleMove} onTouchEnd={handleEnd} onMouseDown={handleStart} onMouseMove={handleMove} onMouseUp={handleEnd} onMouseLeave={handleEnd}>
      <div style={{ transform: `translateX(${offset}px)` }} className={`${color} p-7 text-black shadow-lg flex items-center justify-between transition-transform duration-150 select-none ${!student.isPresent ? 'opacity-30 grayscale' : ''}`}>
        <div>
            <p className="text-2xl font-black leading-tight">{student.firstName} {student.lastName}</p>
            <span className="text-[11px] font-black uppercase opacity-60 tracking-[0.15em]">{student.house} • {student.room}</span>
        </div>
        <button onClick={(e) => { e.stopPropagation(); onKitchenClick(); }} className={`px-6 py-4 rounded-2xl text-[10px] font-black uppercase border tracking-[0.2em] transition-all ${student.isKitchenDuty ? 'bg-black text-white border-black' : 'bg-black/10 border-transparent text-black'}`}>Køkken</button>
      </div>
      {Math.abs(offset) > 20 && (
          <div className={`absolute inset-y-0 ${offset > 0 ? 'left-6' : 'right-6'} flex items-center justify-center opacity-40 pointer-events-none`}>
              <ArrowRightLeft className="w-8 h-8 text-black"/>
          </div>
      )}
    </div>
  );
};

// --- HOVED APP ---
const App = () => {
  const [students, setStudents] = useState([]);
  const [activeTab, setActiveTab] = useState('import');
  const [taskAssignments, setTaskAssignments] = useState({});
  const [cleaningAssignments, setCleaningAssignments] = useState({});
  const [lockedSlots, setLockedSlots] = useState({});
  const [previewType, setPreviewType] = useState(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [brandListDay, setBrandListDay] = useState(getActualDayName());
  const [expandedHouses, setExpandedHouses] = useState({});
  const [editingLoc, setEditingLoc] = useState(null);
  const [manualAdd, setManualAdd] = useState(null);
  const [showFaq, setShowFaq] = useState(false);

  // Persistence
  useEffect(() => {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      try {
        const p = JSON.parse(saved);
        if (p.students) setStudents(p.students);
        setTaskAssignments(p.taskAssignments || {});
        setCleaningAssignments(p.cleaningAssignments || {});
        setLockedSlots(p.lockedSlots || {});
      } catch (e) { console.error("Load error", e); }
    }
  }, []);

  useEffect(() => {
    if (students.length > 0) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({ students, taskAssignments, cleaningAssignments, lockedSlots }));
    }
  }, [students, taskAssignments, cleaningAssignments, lockedSlots]);

  // Statistik
  const stats = useMemo(() => {
    const present = students.filter(s => s.isPresent);
    return {
      total: present.length,
      full: present.filter(s => s.stayType === 'full').length,
      sat: present.filter(s => s.stayType === 'saturday').length,
      kitchen: students.filter(s => s.isKitchenDuty).length
    };
  }, [students]);

  // Auto-generation
  const performAutoGeneration = useCallback((currentSts = students) => {
    const newTasks = { ...taskAssignments };
    const newClean = { ...cleaningAssignments };
    
    // Ryd kun ulåste slots
    Object.keys(newTasks).forEach(k => !lockedSlots[k] && (newTasks[k] = []));
    Object.keys(newClean).forEach(k => !lockedSlots[k] && (newClean[k] = []));

    const eligible = currentSts.filter(s => s.isPresent && !s.isKitchenDuty);
    let pool = [...eligible].sort(() => Math.random() - 0.5);
    let used = new Set();
    Object.entries(taskAssignments).forEach(([k, v]) => { if(lockedSlots[k]) v.forEach(id => used.add(id)); });

    TASK_CONFIG.forEach(t => {
      if (lockedSlots[t.id]) return;
      const assigned = pool.filter(s => !used.has(s.id)).slice(0, 2).map(s => s.id);
      newTasks[t.id] = assigned;
      assigned.forEach(id => used.add(id));
    });

    const cleanEligible = currentSts.filter(s => s.stayType === 'full' && !s.isKitchenDuty);
    let cPool = [...cleanEligible].sort(() => Math.random() - 0.5);
    let cIdx = 0;
    CLEANING_CONFIG.forEach(area => {
      if (lockedSlots[area.name]) return;
      const assigned = cPool.slice(cIdx, cIdx + area.count).map(s => s.id);
      newClean[area.name] = assigned;
      cIdx += area.count;
    });

    setTaskAssignments(newTasks);
    setCleaningAssignments(newClean);
  }, [students, taskAssignments, cleaningAssignments, lockedSlots]);

  const handleFileUpload = (e) => {
    const file = e.target.files?.[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const wb = XLSX.read(ev.target.result, { type: 'binary' });
        const ws = wb.Sheets[wb.SheetNames[0]];
        const data = XLSX.utils.sheet_to_json(ws, { header: 1 });
        const parsed = processExcelData(data);
        if (parsed.length > 0) {
          setStudents(parsed);
          setActiveTab('students');
          setTimeout(() => performAutoGeneration(parsed), 100);
        }
      } catch (err) { alert("Fejl ved læsning af filen. Sørg for at det er en Excel-fil."); }
    };
    reader.readAsBinaryString(file);
  };

  const houseOrder = useMemo(() => Array.from(new Set(students.map(s => s.house))).filter(Boolean).sort(), [students]);
  const getName = (id) => { const s = students.find(x => x.id === id); return s ? `${s.firstName} ${s.lastName}` : '??'; };
  const filtered = students.filter(s => (s.isPresent || searchTerm) && `${s.firstName} ${s.lastName}`.toLowerCase().includes(searchTerm.toLowerCase())).sort((a,b) => a.firstName.localeCompare(b.firstName));

  return (
    <div className={`min-h-screen ${previewType ? 'bg-white text-black' : 'pb-32'}`}>
      {!previewType && (
        <>
          <header className="p-6 border-b border-white/10 flex justify-between items-center sticky top-0 bg-[#0A0E1A]/80 backdrop-blur-xl z-50">
            <div className="flex items-center gap-3">
              <div className="bg-[#FFB300] p-2 rounded-xl text-black shadow-lg shadow-[#FFB300]/20"><Compass className="w-6 h-6"/></div>
              <h1 className="text-2xl font-black uppercase tracking-tighter">Weekend</h1>
            </div>
            <div className="flex gap-2">
              <button onClick={() => setShowFaq(true)} className="p-2 text-white/40"><HelpCircle className="w-5 h-5"/></button>
              <button onClick={() => { if(confirm("Slet alt?")) { localStorage.clear(); location.reload(); }}} className="p-2 text-red-500/40"><Trash className="w-5 h-5"/></button>
            </div>
          </header>

          <main className="p-4 max-w-xl mx-auto space-y-6">
            {activeTab === 'import' && (
              <div className="py-6 space-y-6">
                <div className="bg-white/5 p-12 rounded-[3rem] border border-white/10 text-center">
                  <Upload className="mx-auto w-12 h-12 text-[#FFB300] mb-6"/>
                  <h2 className="text-2xl font-black mb-4 uppercase">Indlæs Elevdata</h2>
                  <input type="file" id="up" className="hidden" onChange={handleFileUpload} accept=".xlsx, .xls, .csv"/>
                  <label htmlFor="up" className="block w-full py-6 bg-[#00BFA5] text-black rounded-3xl font-black uppercase text-xs cursor-pointer shadow-2xl shadow-[#00BFA5]/20">Vælg Fil</label>
                </div>
                
                {students.length > 0 && (
                  <div className="bg-[#1E88E5]/10 p-8 rounded-[2.5rem] border border-[#1E88E5]/30 space-y-6">
                    <h3 className="text-sm font-black uppercase tracking-widest text-[#1E88E5] flex items-center gap-2"><PieChart className="w-4 h-4"/> Weekend Overblik</h3>
                    <div className="grid grid-cols-2 gap-4">
                       <div className="bg-white/5 p-5 rounded-2xl">
                          <p className="text-[10px] font-black uppercase opacity-40 mb-1">Total Tilmeldt</p>
                          <p className="text-3xl font-black">{stats.total}</p>
                       </div>
                       <div className="bg-white/5 p-5 rounded-2xl">
                          <p className="text-[10px] font-black uppercase opacity-40 mb-1">Hele Weekenden</p>
                          <p className="text-3xl font-black text-[#00BFA5]">{stats.full}</p>
                       </div>
                       <div className="bg-white/5 p-5 rounded-2xl">
                          <p className="text-[10px] font-black uppercase opacity-40 mb-1">Lørdag kl. 12</p>
                          <p className="text-3xl font-black text-[#FFB300]">{stats.sat}</p>
                       </div>
                       <div className="bg-white/5 p-5 rounded-2xl">
                          <p className="text-[10px] font-black uppercase opacity-40 mb-1">Køkkentjans</p>
                          <p className="text-3xl font-black text-[#D81B60]">{stats.kitchen}</p>
                       </div>
                    </div>
                    <button onClick={() => performAutoGeneration()} className="w-full py-5 bg-[#FFB300] text-black rounded-2xl font-black uppercase text-xs shadow-lg">Gendan Plan (Auto-gen)</button>
                  </div>
                )}
              </div>
            )}

            {activeTab === 'students' && (
              <div className="space-y-4">
                <div className="relative"><Search className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-white/20"/><input type="text" placeholder="Søg efter elev eller gang..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full bg-white/5 border border-white/10 p-5 pl-12 rounded-2xl outline-none focus:border-[#FFB300] transition-all"/></div>
                <div className="flex justify-center mb-2"><p className="text-[10px] font-black uppercase text-white/20 tracking-widest flex items-center gap-2"><ArrowRightLeft className="w-4 h-4"/> Swipe for tilmelding • Klik Køkken</p></div>
                {filtered.map((s, i) => (
                  <SwipableStudentCard key={s.id} student={s} color={WISE_COLORS[i % 5]} onSwipe={() => setStudents(p => p.map(x => x.id === s.id ? {...x, isPresent: !x.isPresent, stayType: !x.isPresent ? 'full' : 'none'} : x))} onKitchenClick={() => setStudents(p => p.map(x => x.id === s.id ? {...x, isKitchenDuty: !x.isKitchenDuty} : x))}/>
                ))}
              </div>
            )}

            {activeTab === 'rounds' && (
              <div className="space-y-6">
                <div className="flex justify-between items-center px-2">
                  <h2 className="text-2xl font-black uppercase tracking-tighter">Gang-runde</h2>
                  <div className="flex bg-white/5 p-1 rounded-xl border border-white/10">
                    {['Fredag', 'Lørdag', 'Søndag'].map(d => <button key={d} onClick={() => setBrandListDay(d)} className={`px-4 py-2 text-[10px] font-black uppercase rounded-lg transition-all ${brandListDay === d ? 'bg-[#FFB300] text-black' : 'opacity-30'}`}>{d}</button>)}
                  </div>
                </div>
                {houseOrder.map((house, idx) => {
                  const houseSts = students.filter(s => s.house === house && s.isPresent);
                  const isExp = expandedHouses[house];
                  return (
                    <div key={house} className="bg-white/5 rounded-[2.5rem] border border-white/10 overflow-hidden">
                      <div className="p-7 flex justify-between items-center cursor-pointer" onClick={() => setExpandedHouses(p => ({...p, [house]: !isExp}))}>
                         <div className="flex items-center gap-4">
                            <div className={`${WISE_COLORS[idx % 5]} w-12 h-12 rounded-2xl flex items-center justify-center text-black font-black text-lg shadow-lg`}>{houseSts.length}</div>
                            <span className="font-black uppercase tracking-[0.2em] text-sm">{house}</span>
                         </div>
                         <div className="opacity-20">{isExp ? <ChevronUp/> : <ChevronDown/>}</div>
                      </div>
                      {isExp && (
                        <div className="p-3 border-t border-white/5 space-y-2 bg-black/20">
                          {houseSts.length > 0 ? houseSts.map(s => (
                            <div key={s.id} className="bg-white/5 p-5 rounded-[1.5rem] flex justify-between items-center group">
                               <div className="flex items-center gap-4">
                                  <button onClick={() => setStudents(p => p.map(x => x.id === s.id ? {...x, isMarked: !x.isMarked} : x))} className={`w-10 h-10 rounded-full border-2 flex items-center justify-center transition-all ${s.isMarked ? 'bg-[#00BFA5] border-[#00BFA5] text-black' : 'border-white/10 text-transparent'}`}><Check className="w-5 h-5"/></button>
                                  <div><p className="font-black text-lg">{s.firstName}</p><p className="text-[10px] font-black uppercase opacity-30 tracking-widest">{s.sleepingLocations[brandListDay]}</p></div>
                               </div>
                               <button onClick={() => setEditingLoc(s.id)} className="p-4 bg-white/5 rounded-2xl group-active:scale-95 transition-all"><MapPin className="w-5 h-5 text-[#FFB300]"/></button>
                            </div>
                          )) : <p className="p-6 text-center text-xs font-black uppercase opacity-20 tracking-widest">Ingen elever her</p>}
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            )}

            {activeTab === 'tasks' && (
              <div className="space-y-8">
                <div className="flex justify-between items-center px-2">
                  <h2 className="text-2xl font-black uppercase tracking-tighter">Madtjanser</h2>
                  <button onClick={() => performAutoGeneration()} className="text-[10px] font-black uppercase bg-[#FFB300] text-black px-5 py-2 rounded-xl shadow-lg">Auto-gen</button>
                </div>
                {['Fredag', 'Lørdag', 'Søndag'].map(day => (
                  <div key={day} className="space-y-4">
                    <h3 className="text-xs font-black text-[#FFB300] uppercase tracking-[0.3em] border-b border-white/5 pb-2 ml-2">{day}</h3>
                    {TASK_CONFIG.filter(t => t.day === day).map((t, i) => (
                      <div key={t.id} className={`${WISE_COLORS[i % 5]} p-7 rounded-[3rem] text-black shadow-lg`}>
                        <div className="flex justify-between items-start mb-6">
                          <h4 className="text-xl font-black uppercase leading-none tracking-tight">{t.label}</h4>
                          <button onClick={() => setLockedSlots(p => ({...p, [t.id]: !p[t.id]}))} className="p-2 bg-black/10 rounded-xl">{lockedSlots[t.id] ? <Lock className="w-4 h-4"/> : <Unlock className="w-4 h-4 opacity-40"/>}</button>
                        </div>
                        <div className="flex flex-wrap gap-2">
                           {(taskAssignments[t.id] || []).map(sid => (
                             <div key={sid} className="bg-black/20 px-4 py-3 rounded-2xl text-sm font-black flex items-center gap-3">
                                {getName(sid)} <button onClick={() => setTaskAssignments(p => ({...p, [t.id]: p[t.id].filter(x => x !== sid)}))} className="text-red-700/60"><X className="w-4 h-4"/></button>
                             </div>
                           ))}
                           <button onClick={() => setManualAdd({id: t.id, type: 'task'})} className="p-3 bg-black/10 rounded-2xl hover:bg-black/20 transition-all"><Plus className="w-5 h-5"/></button>
                        </div>
                      </div>
                    ))}
                  </div>
                ))}
              </div>
            )}

            {activeTab === 'cleaning' && (
              <div className="space-y-6">
                <div className="flex justify-between items-center px-2">
                  <h2 className="text-2xl font-black uppercase tracking-tighter">Rengøring</h2>
                  <button onClick={() => performAutoGeneration()} className="text-[10px] font-black uppercase bg-[#FFB300] text-black px-5 py-2 rounded-xl shadow-lg">Auto-gen</button>
                </div>
                <div className="grid grid-cols-1 gap-4">
                   {CLEANING_CONFIG.map((area, idx) => (
                     <div key={area.name} className={`${WISE_COLORS[idx % 5]} p-7 rounded-[3rem] text-black shadow-lg`}>
                        <div className="flex justify-between items-start mb-6">
                           <h4 className="font-black text-lg uppercase leading-none tracking-widest">{area.name}</h4>
                           <button onClick={() => setLockedSlots(p => ({...p, [area.name]: !p[area.name]}))} className="p-2 bg-black/10 rounded-xl">{lockedSlots[area.name] ? <Lock className="w-4 h-4"/> : <Unlock className="w-4 h-4 opacity-40"/>}</button>
                        </div>
                        <div className="flex flex-wrap gap-2">
                           {(cleaningAssignments[area.name] || []).map(sid => (
                             <div key={sid} className="bg-black/20 px-4 py-3 rounded-2xl text-sm font-black flex items-center gap-3">
                                {getName(sid)} <button onClick={() => setCleaningAssignments(p => ({...p, [area.name]: p[area.name].filter(x => x !== sid)}))} className="text-red-700/60"><X className="w-4 h-4"/></button>
                             </div>
                           ))}
                           <button onClick={() => setManualAdd({id: area.name, type: 'cleaning'})} className="p-3 bg-black/10 rounded-2xl hover:bg-black/20 transition-all"><Plus className="w-5 h-5"/></button>
                        </div>
                     </div>
                   ))}
                </div>
              </div>
            )}

            {activeTab === 'sunday' && (
              <div className="space-y-4">
                <h2 className="text-2xl font-black px-2 uppercase tracking-tighter">Søndagslisten</h2>
                {students.sort((a,b) => a.firstName.localeCompare(b.firstName)).map(s => (
                  <div key={s.id} className={`bg-white/5 p-7 rounded-[2.5rem] border border-white/10 flex justify-between items-center ${!s.isPresent ? 'opacity-30' : ''}`}>
                    <div><p className="font-black text-2xl">{s.firstName} {s.lastName}</p><p className="text-[10px] font-black uppercase opacity-20 tracking-[0.2em]">{s.house} • {s.room}</p></div>
                    {s.isPresent ? <span className="bg-[#00BFA5]/20 text-[#00BFA5] px-6 py-4 rounded-2xl font-black text-xs uppercase tracking-widest">Hjemmefra</span> : 
                      <button onClick={() => setStudents(p => p.map(x => x.id === s.id ? {...x, hasReturned: !x.hasReturned} : x))} className={`px-7 py-5 rounded-2xl text-[10px] font-black uppercase border tracking-widest transition-all ${s.hasReturned ? 'bg-[#00BFA5] border-[#00BFA5] text-black shadow-lg shadow-[#00BFA5]/20' : 'border-white/10 text-white/20'}`}>{s.hasReturned ? 'Kommet' : 'Venter'}</button>
                    }
                  </div>
                ))}
              </div>
            )}

            {activeTab === 'print' && (
              <div className="py-10 space-y-6">
                <h2 className="text-2xl font-black text-center uppercase tracking-[0.3em] mb-12 opacity-40 italic">Print & Lister</h2>
                <button onClick={() => setPreviewType('main')} className="w-full p-10 bg-[#FFB300] text-black rounded-[3rem] font-black uppercase flex justify-between items-center shadow-xl shadow-[#FFB300]/10">Tjanser & Rengøring <FileText className="w-8 h-8"/></button>
                <button onClick={() => setPreviewType('brand')} className="w-full p-10 bg-[#D81B60] text-white rounded-[3rem] font-black uppercase flex justify-between items-center shadow-xl shadow-[#D81B60]/10">Brandlister <Flame className="w-8 h-8"/></button>
                <button onClick={() => setPreviewType('sunday')} className="w-full p-10 bg-[#00BFA5] text-black rounded-[3rem] font-black uppercase flex justify-between items-center shadow-xl shadow-[#00BFA5]/10">Søndagslisten <CheckCircle2 className="w-8 h-8"/></button>
              </div>
            )}
          </main>

          <nav className="fixed bottom-0 left-0 right-0 bg-[#0A0E1A]/90 backdrop-blur-3xl border-t border-white/10 p-8 flex justify-around items-center no-print z-[100]">
             <button onClick={() => setActiveTab('import')} className={`p-2 transition-all ${activeTab === 'import' ? 'text-[#FFB300] scale-110' : 'opacity-20'}`}><Database className="w-7 h-7"/></button>
             <button onClick={() => setActiveTab('students')} className={`p-2 transition-all ${activeTab === 'students' ? 'text-[#FFB300] scale-110' : 'opacity-20'}`}><Users className="w-7 h-7"/></button>
             <button onClick={() => setActiveTab('rounds')} className={`p-6 bg-[#FFB300] text-black rounded-[2rem] -top-12 relative shadow-2xl shadow-[#FFB300]/40 transition-all active:scale-90`}><Compass className="w-8 h-8"/></button>
             <button onClick={() => setActiveTab('tasks')} className={`p-2 transition-all ${activeTab === 'tasks' ? 'text-[#FFB300] scale-110' : 'opacity-20'}`}><Utensils className="w-7 h-7"/></button>
             <button onClick={() => setActiveTab('print')} className={`p-2 transition-all ${activeTab === 'print' ? 'text-[#FFB300] scale-110' : 'opacity-20'}`}><FileText className="w-7 h-7"/></button>
          </nav>
        </>
      )}

      {/* PRINT SYSTEM */}
      {previewType && (
        <div className="p-4 bg-white text-black min-h-screen relative font-sans">
          <div className="no-print fixed top-0 left-0 right-0 p-6 bg-black flex justify-between items-center text-white z-[1000]">
             <button onClick={() => setPreviewType(null)} className="p-2 bg-white/10 rounded-full"><X/></button>
             <span className="font-black uppercase tracking-widest text-xs">Print Preview</span>
             <button onClick={() => window.print()} className="bg-[#00BFA5] text-black px-8 py-3 rounded-2xl font-black uppercase text-xs shadow-lg">Print nu</button>
          </div>
          <div className="pt-24 max-w-4xl mx-auto">
             {previewType === 'main' && (
                <div className="space-y-12">
                   <h1 className="text-5xl font-black text-center border-b-[12px] border-black pb-6 mb-12 uppercase italic">Weekend Plan</h1>
                   {['Fredag', 'Lørdag', 'Søndag'].map(day => (
                      <div key={day} className="border-b-2 border-black/10 pb-8">
                         <h3 className="text-3xl font-black mb-6 uppercase text-slate-300 italic">{day}</h3>
                         <div className="grid grid-cols-2 gap-6">
                            {TASK_CONFIG.filter(t => t.day === day).map(t => (
                               <div key={t.id} className="p-6 border-2 border-black/5 rounded-3xl bg-slate-50">
                                  <p className="text-xs font-black uppercase text-slate-400 mb-2 tracking-widest">{t.label}</p>
                                  <p className="text-2xl font-bold">{(taskAssignments[t.id] || []).map(getName).join(' & ') || '---'}</p>
                               </div>
                            ))}
                         </div>
                      </div>
                   ))}
                   <div className="page-break"></div>
                   <h2 className="text-4xl font-black uppercase mt-12 mb-8 border-l-[12px] border-black pl-6">Rengøring</h2>
                   <div className="grid grid-cols-2 gap-x-12 gap-y-8">
                      {CLEANING_CONFIG.map(area => (
                         <div key={area.name} className="border-b-2 pb-4">
                            <p className="text-xs font-black text-slate-400 uppercase mb-1">{area.name}</p>
                            <p className="font-bold text-xl">{(cleaningAssignments[area.name] || []).map(getName).join(', ') || '---'}</p>
                         </div>
                      ))}
                   </div>
                </div>
             )}
             {previewType === 'brand' && (
                <div className="space-y-10">
                   {houseOrder.map((loc, i) => {
                      const sts = students.filter(s => s.isPresent && s.sleepingLocations[brandListDay].startsWith(loc));
                      return (
                        <div key={loc} className="p-[15mm] border-[15px] border-red-600 min-h-[290mm] page-break relative flex flex-col">
                           <div className="flex justify-between items-end border-b-[10px] border-red-600 pb-6 mb-12">
                              <div>
                                <h1 className="text-6xl font-black text-red-600 uppercase italic leading-none">Brandliste</h1>
                                <p className="text-xl font-black mt-2 uppercase tracking-[0.4em] opacity-40">Wiselist Weekend</p>
                              </div>
                              <p className="text-[120px] font-black text-red-600 leading-none">{sts.length}</p>
                           </div>
                           <h2 className="text-[80px] font-black uppercase mb-12 tracking-tight">{loc}</h2>
                           <div className="space-y-4 flex-1">
                              {sts.map(s => (
                                 <div key={s.id} className="flex justify-between items-center text-4xl font-bold border-b-2 border-black/5 pb-4">
                                    <span>{s.firstName} {s.lastName}</span>
                                    <span className="text-red-600 font-black">{s.room}</span>
                                 </div>
                              ))}
                           </div>
                           <div className="flex justify-between text-xs font-black uppercase opacity-20 pt-10">
                             <span>Dato: _________________</span>
                             <span>{brandListDay} Nat • Side {i+1} af {houseOrder.length}</span>
                           </div>
                        </div>
                      );
                   })}
                </div>
             )}
             {previewType === 'sunday' && (
                <div className="p-8">
                   <h1 className="text-5xl font-black uppercase mb-12 border-b-[12px] border-black pb-4">Søndagslisten</h1>
                   <div className="grid grid-cols-1 gap-1">
                      {students.sort((a,b) => a.firstName.localeCompare(b.firstName)).map(s => (
                         <div key={s.id} className="flex justify-between items-center py-5 border-b border-slate-100">
                            <div className={!s.isPresent ? 'opacity-20' : ''}>
                               <p className="text-2xl font-bold">{s.firstName} {s.lastName}</p>
                               <p className="text-sm uppercase text-slate-400 font-black tracking-widest">{s.house} • {s.room}</p>
                            </div>
                            <div className="w-16 h-16 border-4 border-black flex items-center justify-center font-black text-3xl">{s.isPresent ? 'HU' : ''}</div>
                         </div>
                      ))}
                   </div>
                </div>
             )}
          </div>
        </div>
      )}

      {/* MODALS */}
      {showFaq && (
        <div className="fixed inset-0 bg-black/95 z-[1000] flex items-center justify-center p-6 no-print backdrop-blur-md">
           <div className="bg-[#151926] w-full max-w-lg rounded-[3rem] p-10 border border-white/10 overflow-y-auto max-h-[85vh] space-y-8 relative">
              <button onClick={() => setShowFaq(false)} className="absolute top-8 right-8 p-3 bg-white/5 rounded-full"><X/></button>
              <div className="flex items-center gap-4 text-[#FFB300]">
                <HelpCircle className="w-10 h-10"/>
                <h2 className="text-3xl font-black uppercase">Quick-Guide</h2>
              </div>
              <div className="space-y-6">
                 <div className="flex gap-4">
                    <div className="w-10 h-10 bg-[#00BFA5] rounded-xl flex items-center justify-center text-black shrink-0"><ArrowRightLeft className="w-5 h-5"/></div>
                    <div><h4 className="font-black uppercase text-xs mb-1">Swipe for tilmelding</h4><p className="text-white/40 text-sm">Træk elev-kortet til siden for at melde til eller fra. Hurtigt og nemt.</p></div>
                 </div>
                 <div className="flex gap-4">
                    <div className="w-10 h-10 bg-[#FFB300] rounded-xl flex items-center justify-center text-black shrink-0"><Plus className="w-5 h-5"/></div>
                    <div><h4 className="font-black uppercase text-xs mb-1">Manuel tildeling</h4><p className="text-white/40 text-sm">Brug + knappen i tjanser eller rengøring for at vælge en specifik elev.</p></div>
                 </div>
                 <div className="flex gap-4">
                    <div className="w-10 h-10 bg-[#1E88E5] rounded-xl flex items-center justify-center text-white shrink-0"><Lock className="w-5 h-5"/></div>
                    <div><h4 className="font-black uppercase text-xs mb-1">Lås runder</h4><p className="text-white/40 text-sm">Lås en tjans for at bevare tildelingen, når du kører "Auto-gen".</p></div>
                 </div>
                 <div className="bg-white/5 p-6 rounded-3xl border border-white/5 italic text-sm text-white/60">
                    <Info className="inline w-4 h-4 mr-2 mb-1"/> Tip: Under "Gange" kan du klikke på kort-ikonet for at ændre sovested (f.eks. Gymnastiksalen eller Shelter).
                 </div>
              </div>
              <button onClick={() => setShowFaq(false)} className="w-full py-5 bg-white text-black rounded-2xl font-black uppercase tracking-widest text-xs">Forstået</button>
           </div>
        </div>
      )}

      {editingLoc && (
        <div className="fixed inset-0 bg-black/95 z-[600] flex items-center justify-center p-6 no-print backdrop-blur-md">
          <div className="bg-[#151926] w-full max-w-md rounded-[3.5rem] p-10 border border-white/10 overflow-y-auto max-h-[90vh]">
             <div className="flex justify-between items-center mb-8"><h3 className="text-2xl font-black uppercase tracking-tight">Vælg Sovested</h3><button onClick={() => setEditingLoc(null)} className="p-2 bg-white/5 rounded-full"><X/></button></div>
             <div className="grid grid-cols-1 gap-3">
               <button onClick={() => { 
                 const s = students.find(x => x.id === editingLoc);
                 if(s) { setStudents(p => p.map(x => x.id === editingLoc ? {...x, sleepingLocations: {...x.sleepingLocations, [brandListDay]: `${s.house} - ${s.room}`}} : x)); setEditingLoc(null); }
               }} className="w-full p-6 bg-white/5 border border-white/5 rounded-3xl text-left font-black uppercase text-[10px] tracking-widest flex justify-between items-center group hover:bg-white/10">Standard Værelse <Home className="w-4 h-4 opacity-30 group-hover:opacity-100"/></button>
               
               <div className="h-4"></div>
               <p className="text-[10px] font-black uppercase text-white/20 ml-2 tracking-widest mb-1">Fællesområder</p>
               {COMMON_SLEEPING_AREAS.map(area => (
                  <button key={area} onClick={() => { setStudents(p => p.map(s => s.id === editingLoc ? {...s, sleepingLocations: {...s.sleepingLocations, [brandListDay]: area}} : s)); setEditingLoc(null); }} className="w-full p-6 bg-white/5 rounded-3xl text-left font-black uppercase text-xs hover:bg-[#FFB300] hover:text-black transition-all flex justify-between items-center group"><span>{area}</span> <Bed className="w-4 h-4 opacity-0 group-hover:opacity-100"/></button>
               ))}
             </div>
             <button onClick={() => setEditingLoc(null)} className="w-full p-5 mt-10 border border-white/10 rounded-2xl text-[10px] font-black uppercase tracking-widest opacity-40">Annuller</button>
          </div>
        </div>
      )}

      {manualAdd && (
        <div className="fixed inset-0 bg-black/95 z-[600] flex items-center justify-center p-6 no-print backdrop-blur-md">
          <div className="bg-[#151926] w-full max-w-md rounded-[3rem] p-10 flex flex-col max-h-[85vh] border border-white/10">
             <div className="flex justify-between items-center mb-8"><h3 className="text-2xl font-black uppercase">Tildel Elev</h3><button onClick={() => setManualAdd(null)} className="p-2 bg-white/5 rounded-full"><X/></button></div>
             <div className="relative mb-6"><Search className="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-white/20"/><input type="text" placeholder="Søg..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="w-full bg-white/5 border border-white/10 p-4 pl-12 rounded-2xl outline-none"/></div>
             <div className="overflow-y-auto space-y-3 pr-2 custom-scroll">
                {students.filter(s => s.isPresent && `${s.firstName} ${s.lastName}`.toLowerCase().includes(searchTerm.toLowerCase())).map(s => (
                   <button key={s.id} onClick={() => {
                      if (manualAdd.type === 'task') setTaskAssignments(p => ({...p, [manualAdd.id]: Array.from(new Set([...(p[manualAdd.id] || []), s.id]))}));
                      else setCleaningAssignments(p => ({...p, [manualAdd.id]: Array.from(new Set([...(p[manualAdd.id] || []), s.id]))}));
                      setManualAdd(null);
                      setSearchTerm('');
                   }} className="w-full p-6 bg-white/5 rounded-3xl text-left font-black uppercase text-xs flex justify-between items-center group hover:bg-[#00BFA5] hover:text-black transition-all">
                     <div><p className="text-lg font-black normal-case">{s.firstName} {s.lastName}</p><p className="text-[9px] opacity-40">{s.house}</p></div>
                     <Plus className="w-5 h-5 opacity-0 group-hover:opacity-100"/>
                   </button>
                ))}
             </div>
             <button onClick={() => setManualAdd(null)} className="w-full p-5 mt-6 border border-white/10 rounded-2xl font-black uppercase text-xs opacity-40">Luk vindue</button>
          </div>
        </div>
      )}
    </div>
  );
};

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>